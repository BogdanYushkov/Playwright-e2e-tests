name: Playwright Tests

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '16'  # Укажите вашу версию Node.js

    - name: Cache npm dependencies
      uses: actions/cache@v3
      with:
        path: node_modules
        key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
        restore-keys: |
          ${{ runner.os }}-node-

    - name: Install dependencies
      run: npm ci  # Используйте npm ci для установки зависимостей точно как указано в package-lock.json

    - name: Print Playwright configuration
      run: cat playwright.config.js  # Выведите конфигурацию Playwright, чтобы убедиться, что все корректно

    - name: Run Playwright tests with verbose logging
      run: npx playwright test --reporter=list --workers=1  # Отключаем параллельность, чтобы исключить проблемы с многозадачностью

    - name: Upload Playwright test results (optional)
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: playwright-test-results
        path: test-results  # Путь к папке с результатами тестов, если она есть

